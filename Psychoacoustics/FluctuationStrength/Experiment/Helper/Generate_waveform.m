function y = Generate_waveform(tone,params,verbose)
% function y = Generate_waveform(tone,params,verbose)
% 
% Author: Rodrigo García

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

    if nargin < 3
        verbose = true;
    end

    y = zeros(1,params.N);
    if strcmp('AM',tone)
        y = generate_am_tone(params);
    elseif strcmp('FM',tone)
        y = generate_fm_tone(params);
    elseif strcmp('AM_BBN',tone)
        y = generate_bbn(params);
    end
    
    if params.w ~= 0
        y = Do_cos_ramp(y,params.fs,params.w,params.w);
    end

    function x = generate_am_tone(params)
        if verbose
            fprintf([
                'Generating AM tone for' ...
                ' fc = %d Hz' ...
                ', fm = %.2f Hz' ...
                ', md = %.2f' ...
                ', SPL = %d dB' ...
                ', w = %d ms' ...
                ', fs = %d Hz' ...
                ', N = %d' ...
                ' ...\n'
            ],params.fc,params.fm,params.md,params.SPL,params.w...
            ,params.fs,params.N);
        end
    
        x = Generate_AM_tone(params.fc,params.fm,d2m(params.md)...
            ,params.SPL,params.fs,params.N);
    end

    function x = generate_fm_tone(params)
        if verbose
            fprintf([
                'Generating FM tone for' ...
                ' fc = %d Hz' ...
                ', fm = %.2f Hz' ...
                ', df = %d' ...
                ', SPL = %d dB' ...
                ', w = %d ms' ...
                ', fs = %d Hz' ...
                ', N = %d' ...
                ' ...\n'
            ],params.fc,params.fm,params.df,params.SPL,params.w...
            ,params.fs,params.N);
        end
    
        x = Generate_FM_tone(params.fc,params.fm,params.df,params.SPL...
            ,params.fs,params.N)';
    end

    function x = generate_bbn(params)
        if verbose
            fprintf([
                'Generating BBN AM tone for' .....
                ', fm = %.2f Hz' ...
                ', md = %.2f' ...
                ', SPL = %d dB' ...
                ', w = %d ms' ...
                ', fs = %d Hz' ...
                ', N = %d' ...
                ' ...\n'
            ],params.fm,params.md,params.SPL,params.w...
            ,params.fs,params.N);
        end
    
        x = Generate_AM_BBN(params.fm,d2m(params.md),params.SPL...
            ,params.fs,params.N);
    end

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

end
